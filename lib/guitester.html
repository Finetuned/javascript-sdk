<!doctype html>
<html>
<head>
	<title>Simple example ClanOfTheCloud web app</title>
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans">
	<link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Ubuntu+Mono'>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.min.js"></script>

	<style type="text/css">
	body {
		font-family: "Open Sans";
		font-size: 14px;
	}
	#consoleContainer {
		float: right;
		width: 59%;
		background-color: #e8e4e0;
		margin: 15px 0 0 0;
		border: 1px solid #c8c4c0;
		border-radius: 10px;
		position: relative;
	}
	#consoleContainer pre {
		font-family: "Ubuntu Mono";
		font-size: 14px;
		margin: 10px; padding: 0;
		max-height: 300px;
		overflow: auto;
	}
	#consoleContainer span {
		font-size: 12px;
		color: #686460;
		position: absolute;
		background: white;
		top: -10px;
		left: 20px;
	}
	#formContainer {
		float: left;
	    width: 39%;
		margin: 0;
	}
	</style>
</head>

<body>
	
	<h1>いらっしゃいませ！</h1>
	
	<p>
		Welcome to the magnificient test page for our great product. The right area shows the console. The console is a great tool in that it shows what happens with the SDK. You should read it with much interest.
	</p>
	
	<div id="consoleContainer">
		<span>&nbsp;The Great Console&nbsp;</span>
		<pre id="console"></pre>
	</div>

	<div id="formContainer">
		<p>
			Just use the form below to play with our SDK!
		<p>
	
		<p>
			<button id="loginAnonymous" type="button">Log in anonymously</button>
		<p>
	</div>
	

<!-- can also use minified version (22kB, <5kB compressed):
<script src="bundle.min.js"></script>
-->
<script src="bundle.min.js"></script>
<script language="JavaScript">
	var client;

	/**
	 * Fetches the credentials either in the local storage or from the server.
	 */
	function fetchGamerCredentials(whenDone) {
		var gamerData = localStorage.getItem("gamerData");
		if (gamerData) {
			gamerData = JSON.parse(gamerData);
			log("Reused gamer data");
			whenDone(gamerData);
		}
		else {
			log("Trying to log in…");
			client.login(null, function (err, gamer) {
				if (err) {
					log("Error at login", err);
					return;
				}
				localStorage.setItem("gamerData", JSON.stringify(gamer));
				whenDone(gamer);
			});
		}
	}

	/**
	 * Logs a text on the console.
	 */
	function log(text, object) {
		var obj = document.getElementById("console");
		$("#console").append(text + "\n");
		if (object) {
			$("#console").append("->> " + JSON.stringify(object, null, 4) + "\n");
		}
		obj.scrollTop = obj.scrollHeight;
	}
		
	
	$(function() {
		// initialize our client with the APIKEY and APISECRET of the game
		// we can't really protect these, but the server will enforce the Origin is the right one with CORS (in production only)
		// Use your own sandbox keys instead...
		client = Clan('testgame-key', 'testgame-secret');
		if (Storage === undefined) {
			log("No support for local storage, things WILL go wrong!");
		}
		log("Hello world!");
		
		$("#loginAnonymous").click(function() {
			fetchGamerCredentials(function(gamerData) {
				log("Logged in", gamerData);
			});
		});
	});
	

	// Let's login with a new fresh user
/*	client.login(null, function (err, gamer) {
		if (err) {
			console.error(err);
		}
		console.log("gamer object:");
		console.log(gamer);
		// this could be saved to enable fast log-in next time, in localStorage for example
		// If Facebook login is used instead, the gamer will be associated with his FB account
		// It will make future logins easier

		// get an Authenticated client with the return value of login
		// this will set BasicAuthentication on future requests
		authClient = client.withGamer(gamer);

		// now we'll write in the user's private domain
		// domains are used to scope gamer data. The private domain is specific to the game.
		// Note : we could have created a shared domain (in the FrontOffice webapp),
		// to enable sharing data between different games with ACLs.
		var vfs = authClient.gamervfs('private');

		// the vfs object can now be used to access the private domain of the user
		// vfs.set can handle a Javascript object
		vfs.set("example", {key: "value"},function (err, result) {
			if (err) {
				console.error(err);
			}
			console.log("write result:");
			console.log(result);


			// we should now get the javascript object we've written
			vfs.get("example", function (err, data) {
				console.log("read result:");
				console.log(data);

				console.log("data.key:");
				console.log(data.key); // yes, it's the object we've stored...

				// now logout (not mandatory)
				client.withGamer(gamer).logout(function (err) {
					if (err) {
						console.error(err);
					}
					console.log("All Done!");
					document.writeln("All Done! look into the console for more details...");
				});
			});
		});
	});*/

</script>

</body>
</html>